webpackJsonp([6],{"4zgc":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("mvHQ"),i=s.n(a),r=s("k1aN"),n=s("nQYZ"),l=s("oAV5"),o=(s("BEMf"),{data:function(){return{commentTxt:"",isLike:!1,likeModal:!1,baseURL:this.$baseURL,navShow:!0,articleId:"",articleDetail:{meta:{}},operateId:"",tocList:"",topCommentList:[],commentList:[]}},created:function(){},mounted:function(){this.$route.query.articleId&&(this.articleId=this.$route.query.articleId,this.getArticleData())},methods:{getArticleData:function(){var t=this,e=this.articleId,s=this.userInfo;this.$api.article.articleDetail({id:e}).then(function(e){if(e.code===t.$constant.reqSuccess){var a=e.data,i=Object(l.a)(a.content);if(t.tocList=i.tocList,a.content=i.content,t.articleDetail=a,a.linkUser.length>0&&s)for(var r=0;r<a.linkUser.length;r++){if(a.linkUser[r]._id==s.id){t.isLike=!0;break}t.isLike=!1}else t.isLike=!1;t.getCommentList()}else t.$message.warning("获取文章详情失败")})},getCommentList:function(){var t=this,e=this.articleId;this.$api.article.articleCommentList({articleId:e,currentPage:"1",pageSize:"999",status:"1",sortBy:"createTime",sortOrders:"-1"}).then(function(e){var s=e.data.data,a=[];s.length>0&&s.forEach(function(e){e._id==t.operateId?e.expand=!0:e.expand=!1,e.isTop&&a.push(e)}),t.topCommentList=a.length>0?JSON.parse(i()(a)):a,t.commentList=s})},routeBack:function(){this.$router.back(-1)},likeModalShow:function(){this.articleDetail.meta.likeTotal>0&&(this.likeModal=!0)},likeClick:function(){var t=this,e=this.articleDetail,s=this.articleId,a=this.isLike,i=this.userInfo;sessionStorage.getItem("token")?this.$api.article.articleLike({id:s,type:a?"0":"1"}).then(function(s){s.code===t.$constant.reqSuccess&&(t.isLike?(e.meta.likeTotal-=1,e.linkUser=e.linkUser.filter(function(t){t._id,i.id})):(e.meta.likeTotal+=1,e.linkUser.push({avatarId:i.avatarId,_id:i.id,name:i.name})),t.isLike=!t.isLike)}):(this.$store.dispatch("operateLoginModal"),this.$message.warning("登录才能点赞，请先登录"))},commentPublish:function(){var t=this,e=this.articleId,s=this.commentTxt;sessionStorage.getItem("token")?s?this.$api.article.articleComment({articleId:e,content:s}).then(function(e){e.code===t.$constant.reqSuccess&&(t.commentTxt="",t.getArticleData())}):this.$message.warning("评论内容不为空"):(this.$store.dispatch("operateLoginModal"),this.$message.warning("登录才能评论，请先登录"))},replyComment:function(t,e){var s=this;this.articleId;sessionStorage.getItem("token")?(this.operateId="sup"===t?e._id:e.commentId,this.$prompt("回复 @"+("sup"===t?e.createUser.name:e.replyUser.name)+"：","回复评论",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"回复评论",inputValidator:function(t){if(null===t||""===t)return!1},inputErrorMessage:"评论内容不为空"}).then(function(a){var i=a.value;s.$api.article.replyCommentAdd({commentId:"sup"===t?e._id:e.commentId,toUser:"sup"===t?e.createUser._id:e.replyUser._id,content:i}).then(function(t){t.code===s.$constant.reqSuccess?s.getArticleData():s.$message.warning("评论回复失败")})}).catch(function(){})):(this.$store.dispatch("operateLoginModal"),this.$message.warning("登录才能回复评论，请先登录"))},tocClick:function(t){var e=t.target.id;e&&document.querySelector("#"+e).scrollIntoView({behavior:"smooth"})},viewComment:function(){this.$refs.articleComment.scrollIntoView({behavior:"smooth"})}},watch:{userInfo:{handler:function(t){this.getArticleData()},deep:!0}},components:{HeaderNav:r.a,TagBox:n.a},computed:{userInfo:function(){return this.$store.getters.getUserInfo}}}),c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrapper"},[s("header-nav",{attrs:{positionValue:"relative"}}),t._v(" "),s("div",{staticClass:"article-detail"},[s("div",{staticClass:"detail-like"},[s("div",{staticClass:"box-like"},[s("div",{staticClass:"like-icon mio-icon-zan iconfont",class:t.isLike?"like-active":"",on:{click:t.likeClick}}),t._v(" "),s("span",{style:{color:t.isLike?"#ec7259":"#969696"},on:{click:t.likeModalShow}},[t._v(t._s(t.articleDetail.meta.likeTotal)+"\n          赞")])]),t._v(" "),s("div",{staticClass:"box-like",on:{click:t.viewComment}},[s("div",{staticClass:"like-icon el-icon-chat-dot-round"}),t._v(" "),s("span",{staticStyle:{color:"#969696"}},[t._v(t._s(t.articleDetail.meta.commentTotal)+" 评论")])]),t._v(" "),s("div",{staticClass:"box-like",on:{click:t.routeBack}},[s("div",{staticClass:"like-icon el-icon-thumb"}),t._v(" "),s("span",{staticStyle:{color:"#969696"}},[t._v("返回")])])]),t._v(" "),s("div",{staticClass:"detail-content"},[s("div",{staticClass:"content-title"},[t._v("\n        "+t._s(t.articleDetail.title)+"\n      ")]),t._v(" "),s("div",{staticClass:"content-header"},[s("div",{staticClass:"header-info"},[t.articleDetail.createUser?s("el-image",{staticClass:"image-avatar",attrs:{src:t.baseURL+"/file/down?downId="+t.articleDetail.createUser.avatarId}},[s("div",{staticClass:"icon-avatar",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-user-solid"})])]):s("div",{staticClass:"image-avatar"},[s("div",{staticClass:"icon-avatar"},[s("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),s("div",{staticClass:"info-data"},[s("p",[t._v(t._s(t.articleDetail.createUser?t.articleDetail.createUser.name:"--"))]),t._v(" "),s("div",{staticClass:"data-time"},[s("span",[t._v(t._s(t.articleDetail.createTime))]),t._v(" "),s("span",[t._v("字数 "+t._s(t.articleDetail.meta.txtTotal))]),t._v(" "),s("span",[t._v("阅读 "+t._s(t.articleDetail.meta.viewTotal))]),t._v(" "),s("span",[t._v("评论 "+t._s(t.articleDetail.meta.commentTotal))]),t._v(" "),s("span",[t._v("点赞 "+t._s(t.articleDetail.meta.likeTotal))])])])],1)]),t._v(" "),s("div",{directives:[{name:"highlight",rawName:"v-highlight"}],staticClass:"content-data w-e-text",domProps:{innerHTML:t._s(t.articleDetail.content)}}),t._v(" "),s("div",{staticClass:"content-message"},[s("el-divider",[s("div",{ref:"articleComment",staticClass:"message-title"},[t._v("文章评论")])]),t._v(" "),s("div",{staticClass:"message-publish"},[t.userInfo&&t.userInfo.avatarId?s("el-image",{staticClass:"image-avatar",attrs:{src:t.baseURL+"/file/down?downId="+t.userInfo.avatarId}},[s("div",{staticClass:"icon-avatar",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-user-solid"})])]):s("div",{staticClass:"image-avatar"},[s("div",{staticClass:"icon-avatar"},[s("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),s("div",{staticClass:"publish-textarea"},[s("el-input",{attrs:{type:"textarea",rows:3,autosize:{minRows:3,maxRows:6},placeholder:"写下你的评论..."},model:{value:t.commentTxt,callback:function(e){t.commentTxt=e},expression:"commentTxt"}}),t._v(" "),s("div",{staticClass:"textarea-submit"},[s("el-button",{attrs:{round:""},nativeOn:{click:function(e){t.commentTxt=""}}},[t._v("重 置")]),t._v(" "),s("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"success",round:""},on:{click:t.commentPublish}},[t._v("发 布")])],1)],1)],1),t._v(" "),t.topCommentList.length>0?s("div",{staticClass:"message-comment"},[s("h3",[t._v("置顶评论("+t._s(t.topCommentList.length)+")")]),t._v(" "),s("div",{staticClass:"comment-list"},t._l(t.topCommentList,function(e){return s("div",{key:e._id,staticClass:"list-box"},[e.createUser?s("el-image",{staticClass:"image-avatar",attrs:{src:t.baseURL+"/file/down?downId="+e.createUser.avatarId}},[s("div",{staticClass:"icon-avatar",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-user-solid"})])]):s("div",{staticClass:"image-avatar"},[s("div",{staticClass:"icon-avatar"},[s("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),s("div",{staticClass:"box-item"},[s("div",{staticClass:"item-name"},[t._v(t._s(e.createUser?e.createUser.name:"--"))]),t._v(" "),s("div",{staticClass:"item-content"},[t._v(t._s(e.content))]),t._v(" "),s("div",{staticClass:"item-replay"},[s("div",{staticClass:"replay-time"},[t._v(t._s(e.createTime))]),t._v(" "),s("div",{staticClass:"replay-content",on:{click:function(s){return t.replyComment("sup",e)}}},[s("i",{staticClass:"el-icon-chat-dot-round"}),t._v("\n                    回复\n                  ")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.replyCommentList.length>0,expression:"item.replyCommentList.length > 0"}],staticClass:"item-sub",style:{height:e.expand?"100%":"0"}},t._l(e.replyCommentList,function(e){return s("div",{directives:[{name:"show",rawName:"v-show",value:"1"==e.status,expression:'itemSub.status == "1"'}],key:e._id,staticClass:"list-box"},[e.replyUser?s("el-image",{staticClass:"image-avatar",attrs:{src:t.baseURL+"/file/down?downId="+e.replyUser.avatarId}},[s("div",{staticClass:"icon-avatar",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-user-solid"})])]):s("div",{staticClass:"image-avatar"},[s("div",{staticClass:"icon-avatar"},[s("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),s("div",{staticClass:"box-item"},[s("div",{staticClass:"item-name"},[t._v(t._s(e.replyUser?e.replyUser.name:"--"))]),t._v(" "),s("div",{staticClass:"item-content"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.toUser&&e.replyUser&&e.toUser._id!==e.replyUser._id,expression:"itemSub.toUser && itemSub.replyUser && itemSub.toUser._id !==  itemSub.replyUser._id"}],staticClass:"content-replay"},[t._v("\n                          回复 "),s("i",{staticStyle:{color:"#409EFF"}},[t._v(t._s(e.toUser?e.toUser.name:"--"))]),t._v(" 的评论：\n                        ")]),t._v(" "),s("span",[t._v(t._s(e.content))])]),t._v(" "),s("div",{staticClass:"item-replay"},[s("div",{staticClass:"replay-time"},[t._v(t._s(e.createTime))]),t._v(" "),s("div",{staticClass:"replay-content",on:{click:function(s){return t.replyComment("sub",e)}}},[s("i",{staticClass:"el-icon-chat-dot-round"}),t._v("\n                          回复\n                        ")])])])],1)}),0),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.replyCommentList.length>0,expression:"item.replyCommentList.length > 0"}],staticClass:"item-expand",on:{click:function(t){e.expand=!e.expand}}},[t._v("\n                  "+t._s(e.expand?"收起":"展开"+e.replyCommentNum+"条回复")+"\n                ")])])],1)}),0)]):t._e(),t._v(" "),s("div",{staticClass:"message-comment"},[s("h3",[t._v("全部评论("+t._s(t.commentList.length)+")")]),t._v(" "),s("div",{staticClass:"comment-list"},t._l(t.commentList,function(e){return s("div",{key:e._id,staticClass:"list-box"},[e.createUser?s("el-image",{staticClass:"image-avatar",attrs:{src:t.baseURL+"/file/down?downId="+e.createUser.avatarId}},[s("div",{staticClass:"icon-avatar",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-user-solid"})])]):s("div",{staticClass:"image-avatar"},[s("div",{staticClass:"icon-avatar"},[s("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),s("div",{staticClass:"box-item"},[s("div",{staticClass:"item-name"},[t._v(t._s(e.createUser?e.createUser.name:"--"))]),t._v(" "),s("div",{staticClass:"item-content"},[t._v(t._s(e.content))]),t._v(" "),s("div",{staticClass:"item-replay"},[s("div",{staticClass:"replay-time"},[t._v(t._s(e.createTime))]),t._v(" "),s("div",{staticClass:"replay-content",on:{click:function(s){return t.replyComment("sup",e)}}},[s("i",{staticClass:"el-icon-chat-dot-round"}),t._v("\n                    回复\n                  ")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.replyCommentList.length>0,expression:"item.replyCommentList.length > 0"}],staticClass:"item-sub",style:{height:e.expand?"100%":"0"}},t._l(e.replyCommentList,function(e){return s("div",{directives:[{name:"show",rawName:"v-show",value:"1"==e.status,expression:'itemSub.status == "1"'}],key:e._id,staticClass:"list-box"},[e.replyUser?s("el-image",{staticClass:"image-avatar",attrs:{src:t.baseURL+"/file/down?downId="+e.replyUser.avatarId}},[s("div",{staticClass:"icon-avatar",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-user-solid"})])]):s("div",{staticClass:"image-avatar"},[s("div",{staticClass:"icon-avatar"},[s("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),s("div",{staticClass:"box-item"},[s("div",{staticClass:"item-name"},[t._v(t._s(e.replyUser?e.replyUser.name:"--"))]),t._v(" "),s("div",{staticClass:"item-content"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.toUser&&e.replyUser&&e.toUser._id!==e.replyUser._id,expression:"itemSub.toUser && itemSub.replyUser && itemSub.toUser._id !==  itemSub.replyUser._id"}],staticClass:"content-replay"},[t._v("\n                          回复 "),s("i",{staticStyle:{color:"#409EFF"}},[t._v(t._s(e.toUser?e.toUser.name:"--"))]),t._v(" 的评论：\n                        ")]),t._v(" "),s("span",[t._v(t._s(e.content))])]),t._v(" "),s("div",{staticClass:"item-replay"},[s("div",{staticClass:"replay-time"},[t._v(t._s(e.createTime))]),t._v(" "),s("div",{staticClass:"replay-content",on:{click:function(s){return t.replyComment("sub",e)}}},[s("i",{staticClass:"el-icon-chat-dot-round"}),t._v("\n                          回复\n                        ")])])])],1)}),0),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.replyCommentList.length>0,expression:"item.replyCommentList.length > 0"}],staticClass:"item-expand",on:{click:function(t){e.expand=!e.expand}}},[t._v("\n                  "+t._s(e.expand?"收起":"展开"+e.replyCommentNum+"条回复")+"\n                ")])])],1)}),0)])],1)]),t._v(" "),s("div",{staticClass:"detail-tocList",domProps:{innerHTML:t._s(t.tocList)},on:{click:t.tocClick}})]),t._v(" "),s("el-dialog",{attrs:{title:t.articleDetail.meta.likeTotal+"人点赞",visible:t.likeModal,width:"640px"},on:{"update:visible":function(e){t.likeModal=e}}},[s("div",t._l(t.articleDetail.linkUser,function(e){return s("div",{key:e._id,staticClass:"like-dialog"},[e.avatarId?s("el-image",{staticClass:"image-avatar",attrs:{src:t.baseURL+"/file/down?downId="+e.avatarId}},[s("div",{staticClass:"icon-avatar",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-user-solid"})])]):s("div",{staticClass:"image-avatar"},[s("div",{staticClass:"icon-avatar"},[s("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),s("p",[t._v(t._s(e.name))])],1)}),0)])],1)},staticRenderFns:[]};var v=s("VU/8")(o,c,!1,function(t){s("6pBe")},"data-v-debbdf40",null);e.default=v.exports},"6pBe":function(t,e){},BEMf:function(t,e){}});